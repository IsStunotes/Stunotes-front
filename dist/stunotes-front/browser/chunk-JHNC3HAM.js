import{a as Y}from"./chunk-Z47XEYJ7.js";import{a as B}from"./chunk-LIDSFJIZ.js";import{a as j}from"./chunk-J5CVK4QX.js";import{a as V}from"./chunk-AWXY37MH.js";import{a as z}from"./chunk-UGJ6NOTJ.js";import{a as N}from"./chunk-VBS6FHQU.js";import"./chunk-EV5VSRPK.js";import{f as T,g as L,i as F}from"./chunk-VFWRGXPW.js";import{Da as b,Ib as S,Jb as E,Kb as D,Lb as I,Oa as p,Pa as i,Qa as a,Ra as u,Sa as y,Ta as k,U as d,Ua as v,V as m,Va as f,Wa as l,cb as c,db as C,eb as O,fb as P,lb as w,mb as M,nb as R,pa as s,ta as x,za as h}from"./chunk-FOFVNQTZ.js";import{e as q}from"./chunk-EQDQRRRY.js";var _=q(Y());var H=n=>["/document",n,"comments"];function U(n,o){n&1&&(i(0,"div",4),c(1,"Cargando repositorios..."),a())}function J(n,o){if(n&1&&(i(0,"div",5),c(1),a()),n&2){let e=l();s(),C(e.error)}}function K(n,o){n&1&&(i(0,"div",18),c(1," A\xFAn no se ha creado un repositorio "),a())}function G(n,o){if(n&1){let e=v();i(0,"div",25)(1,"a",26)(2,"div",27)(3,"h3"),c(4),a(),i(5,"p"),c(6),a(),i(7,"small"),c(8),M(9,"date"),a()()(),i(10,"button",22),f("click",function(r){let g=d(e).$implicit,$=l().$implicit;return l(2).eliminarDocumento(g.id,$.id),m(r.stopPropagation())}),c(11," \u{1F5D1}\uFE0F Eliminar "),a()()}if(n&2){let e=o.$implicit;s(),p("routerLink",w(8,H,e.id)),s(3),C(e.title),s(2),C(e.description),s(2),P(" Documento v",e.version," \u2013 ",R(9,5,e.dateCreated,"yyyy-MM-dd")," ")}}function Q(n,o){if(n&1){let e=v();y(0),i(1,"div",19)(2,"h2"),c(3),a(),i(4,"div",20)(5,"button",21),f("click",function(){let r=d(e).$implicit,g=l(2);return m(g.crearDocumento(r.id))}),c(6," + Crear nuevo documento "),a(),i(7,"button",22),f("click",function(){let r=d(e).$implicit,g=l(2);return m(g.eliminarRepositorio(r.id))}),c(8," \u{1F5D1}\uFE0F Eliminar repositorio "),a()(),i(9,"div",23),b(10,G,12,10,"div",24),a()(),k()}if(n&2){let e=o.$implicit;s(3),O("Repositorio ",e.id),s(7),p("ngForOf",e.documents)}}function W(n,o){if(n&1){let e=v();i(0,"div")(1,"div",6)(2,"div",7)(3,"button",8),f("click",function(){d(e);let r=l();return m(r.cancelar())}),u(4,"i",9),c(5," Atr\xE1s "),a(),i(6,"button",10),f("click",function(){d(e);let r=l();return m(r.crearRepositorio())}),u(7,"i",11),c(8," Nuevo Repositorio "),a()(),i(9,"div",12)(10,"div",13),u(11,"input",14),i(12,"span",15),c(13,"\u{1F50D}"),a()()()(),b(14,K,2,0,"div",16)(15,Q,11,2,"ng-container",17),u(16,"app-footer"),a()}if(n&2){let e=l();s(14),p("ngIf",e.repositories.length===0&&!e.loading),s(),p("ngForOf",e.repositories)}}var A=class n{constructor(o,e,t){this.repositoryService=o;this.documentService=e;this.router=t}repositories=[];loading=!1;error="";ngOnInit(){this.loadRepositories()}loadRepositories(){this.loading=!0;let o=localStorage.getItem("user");if(!o){this.error="No hay usuario autenticado.",this.loading=!1;return}let e=JSON.parse(o);e.role==="TEACHER"||e.roleId===2?this.repositoryService.getAllRepositories().subscribe({next:t=>{this.repositories=t,this.loading=!1},error:t=>{console.error("Error al obtener todos los repositorios:",t),this.error="Error al cargar todos los repositorios",this.loading=!1}}):this.repositoryService.getRepositoriesByUsuarioId(e.id).subscribe({next:t=>{this.repositories=t,this.loading=!1},error:t=>{console.error("Error al obtener repositorios del usuario:",t),this.error="Error al cargar repositorios del usuario",this.loading=!1}})}crearDocumento(o){this.router.navigate(["/document/create"],{queryParams:{repositoryId:o}})}cancelar(){history.back()}crearRepositorio(){let o=localStorage.getItem("user");if(!o){alert("No hay usuario autenticado.");return}let t={userId:JSON.parse(o).id};console.log("Payload enviado al backend:",t),this.repositoryService.saveRepository(t).subscribe({next:r=>{this.repositories.push(r),_.default.fire({icon:"success",title:"Repositorio creado debajo",text:"Puedes empezar a agregar documentos.",confirmButtonText:"\xA1Perfecto!",width:"80%"})},error:r=>{console.error("Error al crear repositorio:",r),alert("Error al crear repositorio")}})}eliminarRepositorio(o){_.default.fire({title:"\xBFEliminar repositorio?",text:"Se eliminar\xE1 junto con todos sus documentos.",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#e74c3c",cancelButtonColor:"#aaa"}).then(e=>{e.isConfirmed&&this.repositoryService.deleteRepository(o).subscribe({next:()=>{this.repositories=this.repositories.filter(t=>t.id!==o),_.default.fire({icon:"success",title:"Repositorio eliminado",text:"El repositorio fue eliminado correctamente.",confirmButtonText:"OK",width:"70%"})},error:t=>{console.error("Error al eliminar repositorio:",t),_.default.fire({icon:"error",title:"Error",text:"No se pudo eliminar el repositorio porque tiene documentos con COMENTARIOS .",confirmButtonText:"Cerrar"})}})})}eliminarDocumento(o,e){confirm("\xBFDeseas eliminar este documento?")&&this.documentService.deleteDocument(o).subscribe({next:()=>{let t=this.repositories.find(r=>r.id===e);t&&(t.documents=t.documents.filter(r=>r.id!==o))},error:t=>{console.error("Error al eliminar documento:",t),alert("No se pudo eliminar el documento")}})}static \u0275fac=function(e){return new(e||n)(x(B),x(z),x(T))};static \u0275cmp=h({type:n,selectors:[["app-repository-list"]],decls:6,vars:3,consts:[[1,"main-content"],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],[4,"ngIf"],[1,"loading"],[1,"error"],[1,"task-header"],[1,"header-left"],[1,"back-btn",3,"click"],[1,"fas","fa-arrow-left"],[1,"new-task-btn",3,"click"],[1,"fas","fa-plus"],[1,"search-filters"],[1,"search-container"],["type","text","placeholder","Buscar..."],[1,"search-icon"],["class","no-repos-msg",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"no-repos-msg"],[1,"repo-block"],[1,"repo-actions"],[1,"create-btn",3,"click"],[1,"delete-btn",3,"click"],[1,"document-grid"],["class","document-card-wrapper",4,"ngFor","ngForOf"],[1,"document-card-wrapper"],[1,"card-link",3,"routerLink"],[1,"card"]],template:function(e,t){e&1&&(u(0,"app-navbar")(1,"app-sidebar"),i(2,"div",0),b(3,U,2,0,"div",1)(4,J,2,1,"div",2)(5,W,17,2,"div",3),a()),e&2&&(s(3),p("ngIf",t.loading),s(),p("ngIf",t.error),s(),p("ngIf",!t.loading))},dependencies:[I,S,E,D,F,L,V,N,j],styles:["[_nghost-%COMP%]{font-family:Poppins,sans-serif;background:#fdfdfd;display:block}.main-content[_ngcontent-%COMP%]{padding:130px;min-height:calc(100vh - 64px)}.loading[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{text-align:center;margin-top:20px;font-weight:700}.repo-block[_ngcontent-%COMP%]{padding-bottom:1px;margin-bottom:1;border-bottom:1px solid #e5e7eb}h2[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:1px;color:#5f03ff;font-size:1.3rem;font-weight:600;padding:0 2rem}.no-repos-msg[_ngcontent-%COMP%]{text-align:center;font-size:1rem;color:#6b7280;margin:2rem 0;font-style:italic;min-height:600px}.document-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:24px;margin-bottom:1rem;align-items:flex-start;justify-content:flex-start;min-height:500px;padding:0 2rem}.card[_ngcontent-%COMP%]{width:220px;padding:1rem;border:1px solid #ddd;border-radius:12px;background-color:#fff;box-shadow:0 2px 5px #0000000d;display:flex;flex-direction:column;justify-content:space-between}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:.5rem;color:#333}.card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem;color:#555;margin-bottom:.5rem;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:10;line-clamp:10;-webkit-box-orient:vertical}.card[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:.75rem;color:#888}.upload-placeholder[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:220px;height:160px;border:2px dashed #ccc;border-radius:12px;background-color:#f8f8f8;transition:background-color .3s}.upload-placeholder[_ngcontent-%COMP%]:hover{background-color:#f0f0ff}.upload-btn[_ngcontent-%COMP%]{background-color:#eaeaff;border:none;border-radius:50%;font-size:28px;padding:16px;cursor:pointer;transition:background-color .3s,transform .2s}.upload-btn[_ngcontent-%COMP%]:hover{background-color:#d4d4ff;transform:scale(1.1)}.top-bar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background-color:#f4f1ff;padding:.75rem 2rem;border-bottom:1px solid #ddd;position:sticky;top:0;z-index:10}.task-header[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;padding:20px;gap:1rem;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000001a}.header-left[_ngcontent-%COMP%]{display:flex;gap:15px}.back-btn[_ngcontent-%COMP%], .new-task-btn[_ngcontent-%COMP%], .create-btn[_ngcontent-%COMP%], .delete-btn[_ngcontent-%COMP%]{padding:10px 16px;border:none;border-radius:8px;font-weight:500;font-size:.9rem;cursor:pointer;display:flex;align-items:center;gap:8px;transition:background-color .3s,transform .2s}.back-btn[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.back-btn[_ngcontent-%COMP%]:hover{background:#5a6268;transform:translateY(-2px)}.new-task-btn[_ngcontent-%COMP%]{background:#7c3aed;color:#fff}.new-task-btn[_ngcontent-%COMP%]:hover{background-color:#654de0}.create-btn[_ngcontent-%COMP%]{background-color:#7c3aed;color:#fff}.create-btn[_ngcontent-%COMP%]:hover{background-color:#654de0;transform:translateY(-2px)}.delete-btn[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff}.delete-btn[_ngcontent-%COMP%]:hover{background-color:#dc2626;transform:translateY(-2px)}.search-container[_ngcontent-%COMP%]{position:relative;flex:1 1 250px;max-width:300px;margin-left:auto}.search-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:6px 2rem 6px 8px;border-radius:6px;border:1px solid #ccc;box-sizing:border-box}.search-icon[_ngcontent-%COMP%]{position:absolute;right:8px;top:50%;transform:translateY(-50%);font-size:1rem;color:#888}.repo-actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-bottom:.5rem;flex-wrap:wrap;padding:0 2rem}.document-card-wrapper[_ngcontent-%COMP%]{position:relative}.card-link[_ngcontent-%COMP%]{text-decoration:none}@media screen and (max-width: 768px){.task-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.search-container[_ngcontent-%COMP%]{width:100%;margin-left:0;margin-top:1rem}.repo-actions[_ngcontent-%COMP%]{flex-direction:column;gap:10px}.document-grid[_ngcontent-%COMP%]{justify-content:center}}"]})};export{A as RepositoryListComponent};
