import{a as Z}from"./chunk-Z47XEYJ7.js";import{a as q}from"./chunk-J5CVK4QX.js";import{a as z}from"./chunk-AWXY37MH.js";import{a as W}from"./chunk-UGJ6NOTJ.js";import{a as F}from"./chunk-VBS6FHQU.js";import{a as J,c as L,f as K,r as X}from"./chunk-IQH5TXM7.js";import{a as S}from"./chunk-EV5VSRPK.js";import{d as j}from"./chunk-VFWRGXPW.js";import{Da as v,Ib as H,Jb as B,K as C,Kb as T,Lb as N,O as h,Oa as l,Pa as m,Qa as i,Ra as b,Rb as V,Tb as I,U as u,Ua as x,V as f,Va as _,Wa as c,ab as E,cb as s,db as p,eb as M,gb as U,hb as D,ib as k,mb as R,nb as $,ob as A,pa as a,ta as g,za as P}from"./chunk-FOFVNQTZ.js";import{e as Q}from"./chunk-EQDQRRRY.js";var w=Q(Z());var y=class o{constructor(e){this.http=e}apiUrl=`${S.apiUrl}/comments`;getAuthHeaders(){let e=localStorage.getItem("token");return new V({Authorization:`Bearer ${e}`})}getAllComments(e){return this.http.get(this.apiUrl,{headers:e})}saveComment(e){return this.http.post(this.apiUrl,e,{headers:this.getAuthHeaders()})}getCommentById(e){return this.http.get(`${this.apiUrl}/${e}`,{headers:this.getAuthHeaders()})}deleteComment(e){return this.http.delete(`${this.apiUrl}/${e}`,{headers:this.getAuthHeaders()})}getCommentsByDocumentId(e){return this.http.get(`${this.apiUrl}/document/${e}`,{headers:this.getAuthHeaders()})}addCommentToDocument(e,t){return this.http.post(`${this.apiUrl}/document/${e}`,t,{headers:this.getAuthHeaders()})}static \u0275fac=function(t){return new(t||o)(h(I))};static \u0275prov=C({token:o,factory:o.\u0275fac,providedIn:"root"})};var O=class o{constructor(e){this.http=e}apiUrl=`${S.apiUrl}/user/profile`;getAuthHeaders(){return{Authorization:`Bearer ${localStorage.getItem("token")}`}}getUserProfileById(e){return this.http.get(`${this.apiUrl}/${e}`)}updateUserProfile(e,t){return this.http.put(`${this.apiUrl}/${e}`,t)}getUserById(e){return this.http.get(`${this.apiUrl}/${e}`,{headers:this.getAuthHeaders()})}static \u0275fac=function(t){return new(t||o)(h(I))};static \u0275prov=C({token:o,factory:o.\u0275fac,providedIn:"root"})};function ne(o,e){if(o&1&&(m(0,"div",8)(1,"h2"),s(2),i(),m(3,"p"),s(4),i(),m(5,"p")(6,"strong"),s(7),i()()()),o&2){let t=c();a(2),p(t.documento.title),a(2),p(t.documento.description),a(3),M("Versi\xF3n ",t.documento.version)}}function re(o,e){if(o&1){let t=x();m(0,"button",17),_("click",function(){u(t);let r=c().$implicit,d=c(2);return f(d.eliminarComentario(r.id))}),s(1," X "),i()}}function ie(o,e){if(o&1&&(m(0,"div",11)(1,"div",12)(2,"p"),s(3),i(),m(4,"small"),s(5),R(6,"date"),i()(),m(7,"div",13)(8,"span"),s(9),i(),b(10,"div",14),i(),m(11,"div",15),v(12,re,2,0,"button",16),i()()),o&2){let t=e.$implicit,n=c(2);a(3),p(t.content),a(2),p($(6,4,t.fecha,"short")),a(4),p(t.username||t.userId),a(3),l("ngIf",n.esProfesor)}}function me(o,e){if(o&1&&(m(0,"div",9),v(1,ie,13,7,"div",10),i()),o&2){let t=c();a(),l("ngForOf",t.comentarios)}}function ae(o,e){o&1&&(m(0,"p"),s(1,"No hay comentarios a\xFAn."),i())}function se(o,e){if(o&1){let t=x();m(0,"div",18)(1,"input",19),k("ngModelChange",function(r){u(t);let d=c();return D(d.nuevoComentario,r)||(d.nuevoComentario=r),f(r)}),i(),m(2,"button",20),_("click",function(){u(t);let r=c();return f(r.crearComentario())}),s(3,"Enviar"),i()()}if(o&2){let t=c();a(),U("ngModel",t.nuevoComentario)}}var G=class o{constructor(e,t,n,r){this.route=e;this.commentService=t;this.documentService=n;this.userService=r}documentId;comentarios=[];nuevoComentario="";documento;esProfesor=!1;usuarioActual=null;ngOnInit(){this.documentId=+this.route.snapshot.paramMap.get("id"),this.cargarComentarios(),this.cargarDocumento(),this.verificarRolUsuario()}verificarRolUsuario(){let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);this.usuarioActual=t,this.esProfesor=t.role==="TEACHER"||t.roleId===2}}cargarComentarios(){this.commentService.getCommentsByDocumentId(this.documentId).subscribe({next:e=>{this.comentarios=e,this.comentarios.forEach(t=>{this.userService.getUserProfileById(t.userId).subscribe({next:n=>{t.username=`${n.name} ${n.lastName}`},error:n=>{console.error(`No se pudo cargar usuario ${t.userId}`,n),t.username=`Usuario ${t.userId}`}})})},error:e=>console.error("Error al obtener comentarios:",e)})}cargarDocumento(){this.documentService.getDocumentById(this.documentId).subscribe({next:e=>this.documento=e,error:e=>console.error("Error al obtener documento:",e)})}crearComentario(){if(!this.nuevoComentario.trim()){alert("El comentario no puede estar vac\xEDo");return}let e=localStorage.getItem("user");if(!e){alert("Debes iniciar sesi\xF3n para comentar");return}let t=JSON.parse(e),n={contenido:this.nuevoComentario,documentId:this.documentId,userId:t.id};this.commentService.saveComment(n).subscribe({next:r=>{r.username=`${t.name} ${t.lastName}`,this.comentarios.push(r),this.nuevoComentario=""},error:r=>{console.error("Error al guardar comentario:",r),alert("Error al crear el comentario")}})}volver(){history.back()}eliminarComentario(e){w.default.fire({title:"\xBFEliminar comentario?",text:"Esta acci\xF3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#e74c3c",cancelButtonColor:"#aaa"}).then(t=>{t.isConfirmed&&this.commentService.deleteComment(e).subscribe({next:()=>{this.comentarios=this.comentarios.filter(n=>n.id!==e),w.default.fire({icon:"success",title:"Comentario eliminado",text:"El comentario fue borrado correctamente.",confirmButtonText:"OK",width:"70%"})},error:n=>{console.error("Error al eliminar comentario:",n),w.default.fire({icon:"error",title:"Error",text:"No se pudo eliminar el comentario.",confirmButtonText:"Cerrar"})}})})}static \u0275fac=function(t){return new(t||o)(g(j),g(y),g(W),g(O))};static \u0275cmp=P({type:o,selectors:[["app-document-comments"]],decls:14,vars:4,consts:[["sinComentarios",""],[1,"btn-volver",3,"click"],[1,"container"],["class","document",4,"ngIf"],[1,"comments-box"],[1,"comments-title"],["class","comments-list",4,"ngIf","ngIfElse"],["class","new-comment",4,"ngIf"],[1,"document"],[1,"comments-list"],["class","comment",4,"ngFor","ngForOf"],[1,"comment"],[1,"comment-content"],[1,"comment-user"],[1,"avatar"],[1,"comment-actions"],["class","btn-delete",3,"click",4,"ngIf"],[1,"btn-delete",3,"click"],[1,"new-comment"],["type","text","placeholder","Escribe un comentario...",3,"ngModelChange","ngModel"],[3,"click"]],template:function(t,n){if(t&1){let r=x();b(0,"app-navbar")(1,"app-sidebar"),m(2,"button",1),_("click",function(){return u(r),f(n.volver())}),s(3,"\u2B05 Volver"),i(),m(4,"div",2),v(5,ne,8,3,"div",3),m(6,"div",4)(7,"h3",5),s(8,"COMENTARIOS"),i(),v(9,me,2,1,"div",6)(10,ae,2,0,"ng-template",null,0,A)(12,se,4,1,"div",7),i()(),b(13,"app-footer")}if(t&2){let r=E(11);a(5),l("ngIf",n.documento),a(4),l("ngIf",n.comentarios.length>0)("ngIfElse",r),a(3),l("ngIf",n.esProfesor)}},dependencies:[N,H,B,T,X,J,L,K,z,F,q],styles:[".container[_ngcontent-%COMP%]{display:flex;gap:2rem;padding:2rem;font-family:Arial,sans-serif;margin-left:220px}.document[_ngcontent-%COMP%]{background-color:#f9f9f9;border:1px solid #ccc;padding:1.2rem;border-radius:8px;flex:1;max-height:400px;overflow-y:auto}.document[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#8e44ad;font-size:1.5rem}.comments-box[_ngcontent-%COMP%]{background-color:#fff;border:2px solid #6c6c6c;display:flex;flex-direction:column;justify-content:space-between;flex:1}.comments-title[_ngcontent-%COMP%]{text-align:center;color:#6a1b9a;font-weight:700;margin-bottom:1rem}.comments-list[_ngcontent-%COMP%]{flex-grow:1;max-height:300px;overflow-y:auto}.comment[_ngcontent-%COMP%]{position:relative;background-color:#eee;border-radius:5px;padding:.8rem;margin-bottom:1rem;display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto;gap:.5rem}.comment-user[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;font-size:.8rem;justify-content:center}.avatar[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#444;border-radius:50%;margin-top:1rem}.new-comment[_ngcontent-%COMP%]{display:flex;gap:.5rem;border-top:1px solid #ccc;padding-top:.5rem;margin-top:auto}.new-comment[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:.5rem;border:1px solid #aaa;border-radius:4px}.new-comment[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;background-color:#8e44ad;color:#fff;border-radius:4px;cursor:pointer}.btn-volver[_ngcontent-%COMP%]{position:absolute;top:1rem;left:240px;background-color:#7c3aed;color:#fff;padding:10px 16px;border:none;border-radius:8px;font-weight:500;font-size:.9rem;cursor:pointer;display:flex;align-items:center;gap:6px;transition:background-color .3s ease,transform .2s}.btn-volver[_ngcontent-%COMP%]:hover{background-color:#654de0;transform:translateY(-2px)}.btn-delete[_ngcontent-%COMP%]{position:relative;top:10px;left:406px;background-color:#e74c3c;color:#fff;border:none;font-size:1.1rem;font-weight:700;border-radius:50%;width:28px;height:28px;line-height:28px;text-align:center;cursor:pointer;transition:background-color .2s ease}.btn-delete[_ngcontent-%COMP%]:hover{background-color:#c0392b}"]})};export{G as DocumentCommentsComponent};
