import{a as z}from"./chunk-RAU3AXKB.js";import{a as L}from"./chunk-Z47XEYJ7.js";import{a as E}from"./chunk-3K2542WB.js";import{a as N,b as x,c as w,d as S,g as k,j as T,k as R,l as j,m as q,n as V,q as A,s as G}from"./chunk-POKNL4PY.js";import"./chunk-EV5VSRPK.js";import{d as P,f as I}from"./chunk-AVDHOTCV.js";import{Da as d,Ib as O,Jb as y,Lb as F,Oa as l,Pa as r,Qa as i,Ra as c,U as _,Ua as M,V as h,Va as b,Wa as m,bb as v,cb as a,eb as p,pa as n,ta as f,za as C}from"./chunk-LRXCIMQ7.js";import{e as D}from"./chunk-EQDQRRRY.js";var g=D(L());function $(o,t){o&1&&(r(0,"div",8),c(1,"div",9),r(2,"p"),a(3,"Cargando nota..."),i()())}function Y(o,t){if(o&1&&(r(0,"div",31),a(1),i()),o&2){let e=m(2);n(),p(" ",e.getFieldError("title")," ")}}function H(o,t){if(o&1&&(r(0,"div",31),a(1),i()),o&2){let e=m(2);n(),p(" ",e.getFieldError("content")," ")}}function J(o,t){if(o&1&&(r(0,"option",32),a(1),i()),o&2){let e=t.$implicit;l("value",e.id),n(),p(" ",e.name," ")}}function K(o,t){if(o&1&&(r(0,"div",31),a(1),i()),o&2){let e=m(2);n(),p(" ",e.getFieldError("collectionId")," ")}}function Q(o,t){o&1&&c(0,"div",33)}function U(o,t){o&1&&c(0,"i",34)}function W(o,t){if(o&1){let e=M();r(0,"div",10)(1,"form",11),b("ngSubmit",function(){_(e);let u=m();return h(u.onSubmit())}),r(2,"div",12)(3,"label",13),c(4,"i",14),a(5," T\xEDtulo * "),i(),c(6,"input",15),d(7,Y,2,1,"div",16),i(),r(8,"div",12)(9,"label",17),c(10,"i",18),a(11," Contenido * "),i(),r(12,"textarea",19),a(13,"        "),i(),d(14,H,2,1,"div",16),i(),r(15,"div",12)(16,"label",20),c(17,"i",21),a(18," Colecci\xF3n * "),i(),r(19,"select",22)(20,"option",23),a(21,"Selecciona una colecci\xF3n"),i(),d(22,J,2,2,"option",24),i(),d(23,K,2,1,"div",16),i(),r(24,"div",25)(25,"button",26),b("click",function(){_(e);let u=m();return h(u.onCancel())}),c(26,"i",27),a(27," Cancelar "),i(),r(28,"button",28),d(29,Q,1,0,"div",29)(30,U,1,0,"i",30),a(31),i()()()()}if(o&2){let e=m();n(),l("formGroup",e.noteForm),n(5),v("error",e.isFieldInvalid("title")),n(),l("ngIf",e.isFieldInvalid("title")),n(5),v("error",e.isFieldInvalid("content")),n(2),l("ngIf",e.isFieldInvalid("content")),n(5),v("error",e.isFieldInvalid("collectionId")),n(3),l("ngForOf",e.collections),n(),l("ngIf",e.isFieldInvalid("collectionId")),n(2),l("disabled",e.submitting),n(3),l("disabled",e.noteForm.invalid||e.submitting),n(),l("ngIf",e.submitting),n(),l("ngIf",!e.submitting),n(),p(" ",e.submitting?"Guardando...":e.isEditMode?"Actualizar Nota":"Crear Nota"," ")}}var B=class o{constructor(t,e,s,u,X){this.fb=t;this.noteService=e;this.collectionService=s;this.route=u;this.router=X;this.noteForm=this.createForm()}noteForm;collections=[];isEditMode=!1;noteId=null;loading=!1;submitting=!1;ngOnInit(){this.noteId=this.route.snapshot.params.id?+this.route.snapshot.params.id:null,this.isEditMode=!!this.noteId,this.loadCollections(()=>{this.isEditMode&&this.noteId&&this.loadNote(this.noteId)})}createForm(){return this.fb.group({title:["",[x.required,x.maxLength(100)]],content:["",x.required],collectionId:["",x.required]})}loadCollections(t){this.collectionService.getCollections().subscribe({next:e=>{this.collections=e,t&&t()},error:e=>{console.log("note-form.component.ts -> Error al cargar las colecciones:",e),this.showError("Error al cargar las colecciones")}})}loadNote(t){this.loading=!0,this.noteService.getNoteById(t).subscribe({next:e=>{this.noteForm.patchValue({title:e.title,content:e.content,collectionId:e.collection?.id}),this.loading=!1},error:e=>{console.error("note-form.component.ts -> Error al cargar la nota:","error"),this.showError("Error al cargar la nota"),this.loading=!1,this.router.navigate(["/notes"])}})}onSubmit(){if(this.noteForm.invalid){this.markFormGroupAsTouched(),g.default.fire("Error","Por favor, completa todos los campos requeridos.","error");return}if(!this.submitting){this.submitting=!0;let t={title:this.noteForm.value.title,content:this.noteForm.value.content,collectionId:this.noteForm.value.collectionId};this.isEditMode&&this.noteId?this.noteService.updateNote(this.noteId,t).subscribe({next:()=>{g.default.fire("\xC9xito","Nota actualizada correctamente.","success"),this.router.navigate(["/notes"])},error:e=>{console.error("note-form.component.ts -> Error al actualizar la nota:",e),this.submitting=!1,this.showError("Error al actualizar la nota")}}):this.noteService.createNote(t).subscribe({next:()=>{this.submitting=!1,g.default.fire("\xC9xito","Nota creada correctamente.","success"),this.router.navigate(["/notes"])},error:e=>{console.error("note-form.component.ts -> Error al crear la nota:",e),this.submitting=!1,this.showError("Error al crear la nota")}})}}onCancel(){g.default.fire({title:"Cancelar",text:"\xBFEst\xE1s seguro de que quieres cancelar? Los cambios no guardados se perder\xE1n.",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, cancelar",cancelButtonText:"No, seguir editando"}).then(t=>{t.isConfirmed&&this.router.navigate(["/notes"])})}markFormGroupAsTouched(){Object.keys(this.noteForm.controls).forEach(t=>{this.noteForm.get(t)?.markAsTouched()})}isFieldInvalid(t){let e=this.noteForm.get(t);return!!(e&&e.invalid&&(e.dirty||e.touched))}getFieldError(t){let e=this.noteForm.get(t);if(e?.errors){if(e.errors.required)return`${this.getFieldLabel(t)} es requerido`;if(e.errors.maxlength)return`${this.getFieldLabel(t)} no puede exceder ${e.errors.maxlength.requiredLength} caracteres`}return""}getFieldLabel(t){return{title:"El t\xEDtulo",content:"El contenido",collectionId:"La colecci\xF3n"}[t]||t}showError(t){g.default.fire("Error",t,"error")}static \u0275fac=function(e){return new(e||o)(f(A),f(E),f(z),f(P),f(I))};static \u0275cmp=C({type:o,selectors:[["app-note-form"]],decls:10,vars:3,consts:[[1,"form-container"],[1,"form-header"],[1,"form-title"],[1,"fas","fa-sticky-note"],["type","button",1,"back-btn",3,"click"],[1,"fas","fa-arrow-left"],["class","loading-container",4,"ngIf"],["class","form-content",4,"ngIf"],[1,"loading-container"],[1,"loading-spinner"],[1,"form-content"],[1,"note-form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","title",1,"form-label"],[1,"fas","fa-heading"],["type","text","id","title","formControlName","title","placeholder","Ingresa el t\xEDtulo de la nota",1,"form-input"],["class","error-message",4,"ngIf"],["for","content",1,"form-label"],[1,"fas","fa-align-left"],["id","content","formControlName","content","placeholder","Escribe el contenido de la nota...","rows","6",1,"form-textarea"],["for","collectionId",1,"form-label"],[1,"fas","fa-folder-open"],["id","collectionId","formControlName","collectionId",1,"form-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-actions"],["type","button",1,"btn","btn-cancel",3,"click","disabled"],[1,"fas","fa-times"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","btn-spinner",4,"ngIf"],["class","fas fa-save",4,"ngIf"],[1,"error-message"],[3,"value"],[1,"btn-spinner"],[1,"fas","fa-save"]],template:function(e,s){e&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2),c(3,"i",3),a(4),i(),r(5,"button",4),b("click",function(){return s.onCancel()}),c(6,"i",5),a(7," Volver "),i()(),d(8,$,4,0,"div",6)(9,W,32,16,"div",7),i()),e&2&&(n(4),p(" ",s.isEditMode?"Editar Nota":"Nueva Nota"," "),n(4),l("ngIf",s.loading),n(),l("ngIf",!s.loading))},dependencies:[F,O,y,G,k,q,V,N,j,w,S,T,R],styles:['.form-container[_ngcontent-%COMP%]{max-width:700px;margin:0 auto;padding:20px;background:#f8f9fa;min-height:100vh;font-family:"Font Awesome 6 Brand",sans-serif}.form-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding:20px;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000001a}.form-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#1f2937;margin:0;display:flex;align-items:center;gap:12px}.form-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#7c3aed}.back-btn[_ngcontent-%COMP%]{padding:10px 20px;background:#6c757d;color:#fff;border:none;border-radius:8px;font-weight:500;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:8px}.back-btn[_ngcontent-%COMP%]:hover{background:#5a6268;transform:translateY(-2px)}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px;color:#6b7280}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f4f6;border-top:4px solid #7c3aed;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.form-content[_ngcontent-%COMP%]{background:#fff;padding:30px;border-radius:12px;box-shadow:0 2px 8px #0000001a}.note-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.form-label[_ngcontent-%COMP%]{font-weight:600;color:#374151;font-size:14px;display:flex;align-items:center;gap:8px}.form-label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#7c3aed;width:16px}.form-input[_ngcontent-%COMP%], .form-textarea[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{padding:12px 16px;border:2px solid #e5e7eb;border-radius:8px;font-size:14px;transition:all .3s ease;background:#fff}.form-input[_ngcontent-%COMP%]:focus, .form-textarea[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#7c3aed;box-shadow:0 0 0 3px #7c3aed1a}.form-textarea[_ngcontent-%COMP%]{resize:vertical;min-height:100px;font-family:inherit}.form-select[_ngcontent-%COMP%]{cursor:pointer}.form-input.error[_ngcontent-%COMP%], .form-textarea.error[_ngcontent-%COMP%], .form-select.error[_ngcontent-%COMP%]{border-color:#ef4444;box-shadow:0 0 0 3px #ef44441a}.error-message[_ngcontent-%COMP%]{color:#ef4444;font-size:12px;font-weight:500;margin-top:4px}.priority-options[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap}.priority-option[_ngcontent-%COMP%]{display:flex;align-items:center}.priority-radio[_ngcontent-%COMP%]{display:none}.priority-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 20px;border:2px solid #e5e7eb;border-radius:8px;cursor:pointer;transition:all .3s ease;font-weight:500;-webkit-user-select:none;user-select:none}.priority-label[_ngcontent-%COMP%]:hover{border-color:#d1d5db}.priority-radio[_ngcontent-%COMP%]:checked + .priority-label[_ngcontent-%COMP%]{border-color:currentColor;background:#ffffff1a;transform:scale(1.05)}.priority-indicator[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%;background:currentColor}.priority-high[_ngcontent-%COMP%]{color:#dc2626}.priority-medium[_ngcontent-%COMP%]{color:#d97706}.priority-low[_ngcontent-%COMP%]{color:#16a34a}.form-actions[_ngcontent-%COMP%]{display:flex;gap:16px;justify-content:flex-end;margin-top:20px;padding-top:20px;border-top:1px solid #e5e7eb}.btn[_ngcontent-%COMP%]{padding:12px 24px;border:none;border-radius:8px;font-weight:500;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:8px;min-width:120px;justify-content:center}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none!important}.btn-cancel[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.btn-cancel[_ngcontent-%COMP%]:hover:not(:disabled){background:#5a6268;transform:translateY(-2px)}.btn-primary[_ngcontent-%COMP%]{background:#7c3aed;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#6d28d9;transform:translateY(-2px)}.btn-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top:2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@media (max-width: 768px){.form-container[_ngcontent-%COMP%]{padding:10px}.form-header[_ngcontent-%COMP%]{flex-direction:column;gap:15px;align-items:stretch}.form-title[_ngcontent-%COMP%]{justify-content:center}.form-content[_ngcontent-%COMP%]{padding:20px}.priority-options[_ngcontent-%COMP%]{flex-direction:column}.priority-label[_ngcontent-%COMP%]{justify-content:center}.form-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.btn[_ngcontent-%COMP%]{width:100%}}']})};export{B as NoteFormComponent};
