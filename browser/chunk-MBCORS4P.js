import{a as L}from"./chunk-ATQM2GEA.js";import{a as V}from"./chunk-6NPB4U6P.js";import{a as G}from"./chunk-5YRJH3LP.js";import{a as F}from"./chunk-5EFBKWPD.js";import{a as x}from"./chunk-EV5VSRPK.js";import{a as q,c as z,f as W,r as J}from"./chunk-HZNXWY7S.js";import{d as T}from"./chunk-CTUQ4QRL.js";import{Da as C,Ib as k,Jb as A,K as u,Kb as N,Lb as j,O as f,Oa as d,Pa as m,Qa as r,Ra as h,Rb as B,Tb as b,U as v,Ua as y,V as g,Va as O,Wa as c,ab as U,cb as a,db as p,eb as R,gb as D,hb as E,ib as M,mb as w,nb as $,ob as H,pa as s,ta as l,za as P}from"./chunk-QV3KOCKX.js";import"./chunk-EQDQRRRY.js";var _=class o{constructor(e){this.http=e}apiUrl=`${x.apiUrl}/comments`;getAuthHeaders(){let e=localStorage.getItem("token");return new B({Authorization:`Bearer ${e}`})}getAllComments(e){return this.http.get(this.apiUrl,{headers:e})}saveComment(e){return this.http.post(this.apiUrl,e,{headers:this.getAuthHeaders()})}getCommentById(e){return this.http.get(`${this.apiUrl}/${e}`,{headers:this.getAuthHeaders()})}deleteComment(e){return this.http.delete(`${this.apiUrl}/${e}`,{headers:this.getAuthHeaders()})}getCommentsByDocumentId(e){return this.http.get(`${this.apiUrl}/document/${e}`,{headers:this.getAuthHeaders()})}addCommentToDocument(e,t){return this.http.post(`${this.apiUrl}/document/${e}`,t,{headers:this.getAuthHeaders()})}static \u0275fac=function(t){return new(t||o)(f(b))};static \u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"})};var I=class o{constructor(e){this.http=e}apiUrl=`${x.apiUrl}/user/profile`;getAuthHeaders(){return{Authorization:`Bearer ${localStorage.getItem("token")}`}}getUserProfileById(e){return this.http.get(`${this.apiUrl}/${e}`)}updateUserProfile(e,t){return this.http.put(`${this.apiUrl}/${e}`,t)}getUserById(e){return this.http.get(`${this.apiUrl}/${e}`,{headers:this.getAuthHeaders()})}static \u0275fac=function(t){return new(t||o)(f(b))};static \u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"})};function ee(o,e){if(o&1&&(m(0,"div",8)(1,"h2"),a(2),r(),m(3,"p"),a(4),r(),m(5,"p")(6,"strong"),a(7),r()()()),o&2){let t=c();s(2),p(t.documento.title),s(2),p(t.documento.description),s(3),R("Versi\xF3n ",t.documento.version)}}function te(o,e){if(o&1&&(m(0,"div",11)(1,"div",12)(2,"p"),a(3),r(),m(4,"small"),a(5),w(6,"date"),r()(),m(7,"div",13)(8,"span"),a(9),r(),h(10,"div",14),r()()),o&2){let t=e.$implicit;s(3),p(t.content),s(2),p($(6,3,t.fecha,"short")),s(4),p(t.username||t.userId)}}function oe(o,e){if(o&1&&(m(0,"div",9),C(1,te,11,6,"div",10),r()),o&2){let t=c();s(),d("ngForOf",t.comentarios)}}function ne(o,e){o&1&&(m(0,"p"),a(1,"No hay comentarios a\xFAn."),r())}function re(o,e){if(o&1){let t=y();m(0,"div",15)(1,"input",16),M("ngModelChange",function(n){v(t);let S=c();return E(S.nuevoComentario,n)||(S.nuevoComentario=n),g(n)}),r(),m(2,"button",17),O("click",function(){v(t);let n=c();return g(n.crearComentario())}),a(3,"Enviar"),r()()}if(o&2){let t=c();s(),D("ngModel",t.nuevoComentario)}}var Q=class o{constructor(e,t,i,n){this.route=e;this.commentService=t;this.documentService=i;this.userService=n}documentId;comentarios=[];nuevoComentario="";documento;esProfesor=!1;ngOnInit(){this.documentId=+this.route.snapshot.paramMap.get("id"),this.cargarComentarios(),this.cargarDocumento(),this.verificarRolUsuario()}verificarRolUsuario(){let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);this.esProfesor=t.role==="TEACHER"||t.roleId===2}}cargarComentarios(){this.commentService.getCommentsByDocumentId(this.documentId).subscribe({next:e=>{this.comentarios=e,this.comentarios.forEach(t=>{this.userService.getUserProfileById(t.userId).subscribe({next:i=>{t.username=`${i.name} ${i.lastName}`},error:i=>{console.error(`No se pudo cargar usuario ${t.userId}`,i),t.username=`Usuario ${t.userId}`}})})},error:e=>console.error("Error al obtener comentarios:",e)})}cargarDocumento(){this.documentService.getDocumentById(this.documentId).subscribe({next:e=>this.documento=e,error:e=>console.error("Error al obtener documento:",e)})}crearComentario(){if(!this.nuevoComentario.trim()){alert("El comentario no puede estar vac\xEDo");return}let e=localStorage.getItem("user");if(!e){alert("Debes iniciar sesi\xF3n para comentar");return}let t=JSON.parse(e),i={contenido:this.nuevoComentario,documentId:this.documentId,userId:t.id};this.commentService.saveComment(i).subscribe({next:n=>{n.username=`${t.name} ${t.lastName}`,this.comentarios.push(n),this.nuevoComentario=""},error:n=>{console.error("Error al guardar comentario:",n),alert("Error al crear el comentario")}})}volver(){history.back()}static \u0275fac=function(t){return new(t||o)(l(T),l(_),l(G),l(I))};static \u0275cmp=P({type:o,selectors:[["app-document-comments"]],decls:14,vars:4,consts:[["sinComentarios",""],[1,"btn-volver",3,"click"],[1,"container"],["class","document",4,"ngIf"],[1,"comments-box"],[1,"comments-title"],["class","comments-list",4,"ngIf","ngIfElse"],["class","new-comment",4,"ngIf"],[1,"document"],[1,"comments-list"],["class","comment",4,"ngFor","ngForOf"],[1,"comment"],[1,"comment-content"],[1,"comment-user"],[1,"avatar"],[1,"new-comment"],["type","text","placeholder","Escribe un comentario...",3,"ngModelChange","ngModel"],[3,"click"]],template:function(t,i){if(t&1){let n=y();h(0,"app-navbar")(1,"app-sidebar"),m(2,"button",1),O("click",function(){return v(n),g(i.volver())}),a(3,"\u2B05 Volver"),r(),m(4,"div",2),C(5,ee,8,3,"div",3),m(6,"div",4)(7,"h3",5),a(8,"COMENTARIOS"),r(),C(9,oe,2,1,"div",6)(10,ne,2,0,"ng-template",null,0,H)(12,re,4,1,"div",7),r()(),h(13,"app-footer")}if(t&2){let n=U(11);s(5),d("ngIf",i.documento),s(4),d("ngIf",i.comentarios.length>0)("ngIfElse",n),s(3),d("ngIf",i.esProfesor)}},dependencies:[j,k,A,N,J,q,z,W,V,F,L],styles:[".container[_ngcontent-%COMP%]{display:flex;gap:2rem;padding:2rem;font-family:Arial,sans-serif}.document[_ngcontent-%COMP%], .comments-box[_ngcontent-%COMP%]{background-color:#f9f9f9;border:1px solid #ccc;padding:1.2rem;border-radius:8px;flex:1}.document[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#8e44ad;font-size:1.5rem}.comments-box[_ngcontent-%COMP%]{background-color:#fff;border:2px solid #6c6c6c;display:flex;flex-direction:column;justify-content:space-between}.comments-title[_ngcontent-%COMP%]{text-align:center;color:#6a1b9a;font-weight:700;margin-bottom:1rem}.comments-list[_ngcontent-%COMP%]{flex-grow:1}.comment[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;background-color:#eee;padding:.5rem;border-radius:5px}.comment-user[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;font-size:.8rem}.avatar[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#444;border-radius:50%;margin-top:.3rem}.new-comment[_ngcontent-%COMP%]{display:flex;gap:.5rem;border-top:1px solid #ccc;padding-top:.5rem;margin-top:auto}.new-comment[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:.5rem;border:1px solid #aaa;border-radius:4px}.new-comment[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;background-color:#8e44ad;color:#fff;border-radius:4px;cursor:pointer}"]})};export{Q as DocumentCommentsComponent};
